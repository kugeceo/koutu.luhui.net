/*@license
* Drag/Rotate/Resize Library
* Released under the MIT license, 2018-2019
* Karen Sarksyan
* nichollascarter@gmail.com
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).subjx=e()}(this,function(){"use strict";function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function P(o){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?e(a,!0).forEach(function(t){var e,r,n;e=o,n=a[r=t],r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):e(a).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(a,t))})}return o}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t,e){if(null==t)return{};var r,n,o=function(t,e){if(null==t)return{};var r,n,o={},a=Object.keys(t);for(n=0;n<a.length;n++)r=a[n],0<=e.indexOf(r)||(o[r]=t[r]);return o}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(n=0;n<a.length;n++)r=a[n],0<=e.indexOf(r)||Object.prototype.propertyIsEnumerable.call(t,r)&&(o[r]=t[r])}return o}function i(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function se(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],n=!0,o=!1,a=void 0;try{for(var s,i=t[Symbol.iterator]();!(n=(s=i.next()).done)&&(r.push(s.value),!e||r.length!==e);n=!0);}catch(t){o=!0,a=t}finally{try{n||null==i["return"]||i["return"]()}finally{if(o)throw a}}return r}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function W(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var H=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},u=window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(t){clearTimeout(t)},c=Array.prototype,l=c.forEach,h=c.slice,f=c.map,v=c.reduce,ie=console.warn;function rt(t){return null!=t}function q(t){return null==t}function b(t){return"function"==typeof t}function F(t){return b(t)?function(){t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}:function(){}}var y=function(){function a(t){if(s(this,a),"string"==typeof t){var e=document.querySelectorAll(t);this.length=e.length;for(var r=0;r<this.length;r++)this[r]=e[r]}else if("object"!==d(t)||1!==t.nodeType&&t!==document)if(t instanceof a){this.length=t.length;for(var n=0;n<this.length;n++)this[n]=t[n]}else{if(!function(t){return rt(t)&&"object"===d(t)&&(Array.isArray(t)||rt(window.Symbol)&&"function"==typeof t[window.Symbol.iterator]||rt(t.forEach)||"number"==typeof t.length&&(0===t.length||0<t.length&&t.length-1 in t))}(t))throw new Error("Passed parameter must be selector/element/elementArray");for(var o=this.length=0;o<this.length;o++)1===t.nodeType&&(this[o]=t[o],this.length++)}else this[0]=t,this.length=1}return r(a,[{key:"css",value:function(r){var t={setStyle:function(t){return function(t,e){for(var r=t.length;r--;)for(var n in e)t[r].style[n]=e[n];return t.style}(this,t)},getStyle:function(){return function(t){for(var e=t.length;e--;)return t[e].currentStyle?t[e].currentStyle[r]:document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t[e],"")[r]:t[e].style[r]}(this)}};return"string"==typeof r?t.getStyle.apply(this,h.call(arguments,1)):"object"!==d(r)&&r?(ie("Method ".concat(r," does not exist")),!1):t.setStyle.apply(this,arguments)}},{key:"on",value:function(t,e,r,n){for(var o=this.length;o--;)this[o].events||(this[o].events={},this[o].events[t]=[]),"string"!=typeof e?document.addEventListener?this[o].addEventListener(t,e,r||{passive:!1}):document.attachEvent?this[o].attachEvent("on".concat(t),e):this[o]["on".concat(t)]=e:x(this[o],t,e,r,n,!0);return this}},{key:"off",value:function(t,e,r,n){for(var o=this.length;o--;)this[o].events||(this[o].events={},this[o].events[t]=[]),"string"!=typeof e?document.removeEventListener?this[o].removeEventListener(t,e,r):document.detachEvent?this[o].detachEvent("on".concat(t),e):this[o]["on".concat(t)]=null:x(this[o],t,e,r,n,!1);return this}},{key:"is",value:function(t){for(var e=I(t),r=this.length;r--;)if(this[r]===e[r])return!0;return!1}}]),a}();function x(t,e,r,n,o,a){function s(t){for(var e=t.target;e&&e!==this;)e.matches(r)&&n.call(e,t),e=e.parentNode}!0===a?document.addEventListener?t.addEventListener(e,s,o||{passive:!1}):document.attachEvent?t.attachEvent("on".concat(e),s):t["on".concat(e)]=s:document.removeEventListener?t.removeEventListener(e,s,o||{passive:!1}):document.detachEvent?t.detachEvent("on".concat(e),s):t["on".concat(e)]=null}function I(t){return new y(t)}var m=function(){function t(){s(this,t),this.observers={}}return r(t,[{key:"subscribe",value:function(t,e){var r=this.observers;return q(r[t])&&Object.defineProperty(r,t,{value:[]}),r[t].push(e),this}},{key:"unsubscribe",value:function(t,e){var r=this.observers;if(rt(r[t])){var n=r[t].indexOf(e);r[t].splice(n,1)}return this}},{key:"notify",value:function(e,r,n){q(this.observers[e])||this.observers[e].forEach(function(t){if(r!==t)switch(e){case"onmove":t.notifyMove(n);break;case"onrotate":t.notifyRotate(n);break;case"onresize":t.notifyResize(n);break;case"onapply":t.notifyApply(n);break;case"ongetstate":t.notifyGetState(n)}})}}]),t}(),g=function(){function e(t){s(this,e),this.el=t,this.storage=null,this.proxyMethods=null,this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._animate=this._animate.bind(this)}return r(e,[{key:"enable",value:function(t){this._processOptions(t),this._init(this.el),this.proxyMethods.onInit.call(this,this.el)}},{key:"disable",value:function(){_()}},{key:"_init",value:function(){_()}},{key:"_destroy",value:function(){_()}},{key:"_processOptions",value:function(){_()}},{key:"_start",value:function(){_()}},{key:"_moving",value:function(){_()}},{key:"_end",value:function(){_()}},{key:"_animate",value:function(){_()}},{key:"_drag",value:function(){var t;this._processMove.apply(this,arguments),(t=this.proxyMethods.onMove).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"_draw",value:function(){this._animate()}},{key:"_onMouseDown",value:function(t){this._start(t),I(document).on("mousemove",this._onMouseMove).on("mouseup",this._onMouseUp)}},{key:"_onTouchStart",value:function(t){this._start(t.touches[0]),I(document).on("touchmove",this._onTouchMove).on("touchend",this._onTouchEnd)}},{key:"_onMouseMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t,this.el)}},{key:"_onTouchMove",value:function(t){t.preventDefault&&t.preventDefault(),this._moving(t.touches[0],this.el)}},{key:"_onMouseUp",value:function(t){I(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp),this._end(t,this.el)}},{key:"_onTouchEnd",value:function(t){I(document).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd),0===t.touches.length&&this._end(t.changedTouches[0],this.el)}}]),e}();function _(){throw Error("Method not implemented")}function D(t){return t.getBoundingClientRect()}function O(t){return t.css("-webkit-transform")||t.css("-moz-transform")||t.css("-ms-transform")||t.css("-o-transform")||t.css("transform")||"none"}function C(t){var e=t.match(/-?\d+\.?\d+|-?\d+/g);return e?e.map(function(t){return parseFloat(t)}):[1,0,0,1,0,0]}function G(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.add(t);t.split(/\s+/).forEach(function(t){return e.classList.add(t)})}return e}}function N(e,t){if(t){if(e.classList){if(!(-1<t.indexOf(" ")))return e.classList.remove(t);t.split(/\s+/).forEach(function(t){return e.classList.remove(t)})}return e}}function k(t){var e="matrix(".concat(t.join(),")");return{transform:e,webkitTranform:e,mozTransform:e,msTransform:e,otransform:e}}var U=Math.PI/180;function Q(t,e){if(0===e)return t;var r=function(t,e){return 0===e?t:Math.round(t/e)*e}(t,e);return r-t<e?r:void 0}function ce(t,e){var r=1<arguments.length&&void 0!==e?e:6;return Number(t.toFixed(r))}var w=function(){function o(t,e,r){var n;if(s(this,o),(n=i(this,a(o).call(this,t))).constructor===o)throw new TypeError("Cannot construct Transformable instances directly");return n.observable=r,n.enable(e),n}return t(o,g),r(o,[{key:"_cursorPoint",value:function(){throw Error("'_cursorPoint()' method not implemented")}},{key:"_rotate",value:function(){var t;this._processRotate.apply(this,arguments),(t=this.proxyMethods.onRotate).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"_resize",value:function(){var t;this._processResize.apply(this,arguments),(t=this.proxyMethods.onResize).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"_processOptions",value:function(t){var e=this.el;G(e,"sjx-drag");var r={x:10,y:10,angle:10*U},n={move:!1,resize:!1,rotate:!1},o=null,a=!1,s="xy",i="auto",c="auto",l="auto",u="#00a8ff",h=!1,f=function(){},v=function(){},p=function(){},y=function(){},d=function(){},b=function(){},x=e.parentNode;if(rt(t)){var m=t.snap,g=t.each,_=t.axis,w=t.cursorMove,k=t.cursorResize,M=t.cursorRotate,j=t.rotationPoint,T=t.restrict,V=t.onInit,E=t.onDrop,A=t.onMove,S=t.onResize,O=t.onRotate,C=t.onDestroy,P=t.container,D=t.proportions,N=t.themeColor;if(rt(m)){var z=m.x,R=m.y,X=m.angle;r.x=q(z)?10:z,r.y=q(R)?10:R,r.angle=q(X)?r.angle:X*U}if(rt(g)){var Y=g.move,B=g.resize,L=g.rotate;n.move=Y||!1,n.resize=B||!1,n.rotate=L||!1}rt(T)&&(o="parent"===T?e.parentNode:I(T)[0]||document),u=N||"#00a8ff",i=w||"auto",c=k||"auto",l=M||"auto",s=_||"xy",x=rt(P)&&I(P)[0]?I(P)[0]:x,h=j||!1,a=D||!1,f=F(V),d=F(E),v=F(A),y=F(S),p=F(O),b=F(C)}this.options={axis:s,themeColor:u,cursorMove:i,cursorRotate:l,cursorResize:c,rotationPoint:h,restrict:o,container:x,snap:r,each:n,proportions:a},this.proxyMethods={onInit:f,onDrop:d,onMove:v,onResize:y,onRotate:p,onDestroy:b},this.subscribe(n)}},{key:"_animate",value:function(){var t=this,e=t.observable,r=t.storage,n=t.options;if(!q(r)&&(r.frame=H(t._animate),r.doDraw)){r.doDraw=!1;var o=r.dox,a=r.doy,s=r.clientX,i=r.clientY,c=r.doDrag,l=r.doResize,u=r.doRotate,h=r.doSetCenter,f=r.revX,v=r.revY,p=r.handle,y=n.snap,d=n.each,b=n.restrict,x=d.move,m=d.resize,g=d.rotate;if(l){var _=r.transform,w=r.cx,k=r.cy,M=this._pointToElement({x:s,y:i}),j=M.x,T=M.y,V=o?Q(j-w,y.x/_.scX):0,E=a?Q(T-k,y.y/_.scY):0;V=o?f?-V:V:0,E=a?v?-E:E:0,t._resize(V,E,p[0]),m&&e.notify("onresize",t,{dx:V,dy:E,handle:p[0]})}if(c){var A=r.restrictOffset,S=r.elementOffset,O=r.nx,C=r.ny;rt(b)&&(s-A.left<O-S.left&&(s=O-S.left+A.left),i-A.top<C-S.top&&(i=C-S.top+A.top));var P=o?Q(s-O,y.x):0,D=a?Q(i-C,y.y):0;t._drag(P,D),x&&e.notify("onmove",t,{dx:P,dy:D})}if(u){var N=r.pressang,z=r.center,R=Math.atan2(i-z.y,s-z.x)-N;t._rotate(Q(R,y.angle)),g&&e.notify("onrotate",t,{radians:R})}if(h){var X=r.bx,Y=r.by,B=this._pointToControls({x:s,y:i}),L=B.x,F=B.y;t._moveCenterHandle(L-X,F-Y)}}}},{key:"_start",value:function(t){var e=this.observable,r=this.storage,n=this.options,o=this.el,a=this._compute(t);Object.keys(a).forEach(function(t){r[t]=a[t]});var s=a.onRightEdge,i=a.onBottomEdge,c=a.onTopEdge,l=a.onLeftEdge,u=a.handle,h=a.factor,f=a.revX,v=a.revY,p=a.doW,y=a.doH,d=s||i||c||l,b=r.handles,x=r.radius,m=n.axis,g=n.restrict;rt(x)&&N(x,"sjx-hidden");var _=u.is(b.rotator),w=!!rt(b.center)&&u.is(b.center),k=t.clientX,M=t.clientY,j=this._cursorPoint({clientX:k,clientY:M}),T=j.x,V=j.y,E=this._pointToElement({x:T,y:V}),A=E.x,S=E.y,O=this._pointToControls({x:T,y:V}),C={clientX:k,clientY:M,nx:T,ny:V,cx:A,cy:S,bx:O.x,by:O.y,doResize:d,doDrag:!(_||d||w),doRotate:_,doSetCenter:w,onExecution:!0,cursor:null,elementOffset:D(o),restrictOffset:rt(g)?D(g):null,dox:/\x/.test(m)&&(!d||(u.is(b.ml)||u.is(b.mr)||u.is(b.tl)||u.is(b.tr)||u.is(b.bl)||u.is(b.br))),doy:/\y/.test(m)&&(!d||(u.is(b.br)||u.is(b.bl)||u.is(b.bc)||u.is(b.tr)||u.is(b.tl)||u.is(b.tc)))};this.storage=P({},r,{},C),e.notify("ongetstate",this,{factor:h,revX:f,revY:v,doW:p,doH:y}),this._draw()}},{key:"_moving",value:function(t){var e=this.storage,r=this.options,n=this._cursorPoint(t),o=n.x,a=n.y;e.e=t,e.clientX=o,e.clientY=a,e.doDraw=!0;var s=e.doRotate,i=e.doDrag,c=e.doResize,l=e.cursor,u=r.cursorMove,h=r.cursorResize,f=r.cursorRotate;q(l)&&(i?l=u:s?l=f:c&&(l=h),I(document.body).css({cursor:l}))}},{key:"_end",value:function(t){var e=this.observable,r=this.storage,n=this.proxyMethods,o=this.el,a=r.doResize,s=r.doDrag,i=r.frame,c=r.radius,l=a?"resize":s?"drag":"rotate";r.doResize=!1,r.doDrag=!1,r.doRotate=!1,r.doSetCenter=!1,r.doDraw=!1,r.onExecution=!1,r.cursor=null,this._apply(l),n.onDrop.call(this,t,o),e.notify("onapply",this,{actionName:l,e:t}),u(i),I(document.body).css({cursor:"auto"}),rt(c)&&G(c,"sjx-hidden")}},{key:"_checkHandles",value:function(t,e){var r=e.tl,n=e.tc,o=e.tr,a=e.bl,s=e.br,i=e.bc,c=e.ml,l=e.mr,u=!!rt(r)&&t.is(r),h=!!rt(n)&&t.is(n),f=!!rt(o)&&t.is(o),v=!!rt(a)&&t.is(a),p=!!rt(i)&&t.is(i),y=!!rt(s)&&t.is(s),d=!!rt(c)&&t.is(c),b=!!rt(l)&&t.is(l);return{revX:u||d||v||h,revY:u||f||h||d,onTopEdge:h||f||u,onLeftEdge:u||d||v,onRightEdge:f||b||y,onBottomEdge:y||p||v,doW:d||b,doH:h||p}}},{key:"notifyMove",value:function(t){var e=t.dx,r=t.dy;this._drag(e,r)}},{key:"notifyRotate",value:function(t){var e=t.radians,r=this.options.snap;this._rotate(Q(e,r.angle))}},{key:"notifyResize",value:function(t){var e=t.dx,r=t.dy;this._resize(e,r)}},{key:"notifyApply",value:function(t){var e=t.e,r=t.actionName;this.proxyMethods.onDrop.call(this,e,this.el),this._apply(r)}},{key:"notifyGetState",value:function(t){var e=this.storage,r=this._getState(t);this.storage=P({},e,{},r)}},{key:"subscribe",value:function(t){var e=this.observable,r=t.resize,n=t.move,o=t.rotate;(n||r||o)&&e.subscribe("ongetstate",this).subscribe("onapply",this),n&&e.subscribe("onmove",this),r&&e.subscribe("onresize",this),o&&e.subscribe("onrotate",this)}},{key:"unsubscribe",value:function(){this.observable.unsubscribe("ongetstate",this).unsubscribe("onapply",this).unsubscribe("onmove",this).unsubscribe("onresize",this).unsubscribe("onrotate",this)}},{key:"disable",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;q(t)||(t.onExecution&&(this._end(),I(document).off("mousemove",this._onMouseMove).off("mouseup",this._onMouseUp).off("touchmove",this._onTouchMove).off("touchend",this._onTouchEnd)),N(r,"sjx-drag"),this._destroy(),this.unsubscribe(),e.onDestroy.call(this,r),delete this.storage)}}]),o}();function z(t,e){var r=t.x,n=t.y,o=se(e,6),a=o[0],s=o[1],i=o[2],c=o[3];return{x:a*r+i*n+o[4],y:s*r+c*n+o[5]}}function R(t){var e=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]];if(e.length===e[0].length){for(var r=e.length,n=[],o=[],a=0;a<r;a+=1){n[n.length]=[],o[o.length]=[];for(var s=0;s<r;s+=1)n[a][s]=a==s?1:0,o[a][s]=e[a][s]}for(var i=0;i<r;i+=1){var c=o[i][i];if(0===c){for(var l=i+1;l<r;l+=1)if(0!==o[l][i]){for(var u=0;u<r;u++)c=o[i][u],o[i][u]=o[l][u],o[l][u]=c,c=n[i][u],n[i][u]=n[l][u],n[l][u]=c;break}if(0===(c=o[i][i]))return}for(var h=0;h<r;h++)o[i][h]=o[i][h]/c,n[i][h]=n[i][h]/c;for(var f=0;f<r;f++)if(f!=i){c=o[f][i];for(var v=0;v<r;v++)o[f][v]-=c*o[i][v],n[f][v]-=c*n[i][v]}}return[n[0][0],n[1][0],n[0][1],n[1][1],n[0][2],n[1][2]]}}function X(t,e){for(var r=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],n=[[e[0],e[2],e[4]],[e[1],e[3],e[5]],[0,0,1]],o=[],a=0;a<n.length;a++){o[a]=[];for(var s=0;s<r[0].length;s++){for(var i=0,c=0;c<r.length;c++)i+=r[c][s]*n[a][c];o[a].push(i)}}return[o[0][0],o[1][0],o[0][1],o[1][1],o[0][2],o[1][2]]}function Y(t,e,r,n,o,a,s,i,c){var l=parseFloat(r)/2,u=parseFloat(n)/2,h=t+l,f=e+u,v=t-h,p=e-f,y=Math.atan2(i?0:p,c?0:v)+o,d=Math.sqrt(Math.pow(c?0:l,2)+Math.pow(i?0:u,2)),b=Math.cos(y),x=Math.sin(y),m=f+d*(x=!0===s?-x:x);return{left:ce(h+d*(b=!0===a?-b:b)),top:ce(m)}}var M=2,B=7,j=function(){function n(t,e,r){return s(this,n),i(this,a(n).call(this,t,e,r))}return t(n,w),r(n,[{key:"_init",value:function(t){var e=document.createElement("div");G(e,"sjx-wrapper"),t.parentNode.insertBefore(e,t);var r=this.options.rotationPoint,n=t.style,o=n.left,a=n.top,s=n.width,i=n.height,c=I(t),l=s||c.css("width"),u=i||c.css("height"),h={top:a||c.css("top"),left:o||c.css("left"),width:l,height:u,transform:O(c)},f=document.createElement("div");G(f,"sjx-controls");var v={normal:["sjx-normal"],tl:["sjx-hdl","sjx-hdl-t","sjx-hdl-l","sjx-hdl-tl"],tr:["sjx-hdl","sjx-hdl-t","sjx-hdl-r","sjx-hdl-tr"],br:["sjx-hdl","sjx-hdl-b","sjx-hdl-r","sjx-hdl-br"],bl:["sjx-hdl","sjx-hdl-b","sjx-hdl-l","sjx-hdl-bl"],tc:["sjx-hdl","sjx-hdl-t","sjx-hdl-c","sjx-hdl-tc"],bc:["sjx-hdl","sjx-hdl-b","sjx-hdl-c","sjx-hdl-bc"],ml:["sjx-hdl","sjx-hdl-m","sjx-hdl-l","sjx-hdl-ml"],mr:["sjx-hdl","sjx-hdl-m","sjx-hdl-r","sjx-hdl-mr"],rotator:["sjx-hdl","sjx-hdl-m","sjx-rotator"],center:r?["sjx-hdl","sjx-hdl-m","sjx-hdl-c","sjx-hdl-mc"]:void 0};Object.keys(v).forEach(function(t){var e=v[t];if(!q(e)){var r=function(t){var e=document.createElement("div");return t.forEach(function(t){G(e,t)}),e}(e);v[t]=r,f.appendChild(r)}}),rt(v.center)&&I(v.center).css({left:"".concat(t.getAttribute("data-cx"),"px"),top:"".concat(t.getAttribute("data-cy"),"px")});e.appendChild(f);var p=I(f);p.css(h),this.storage={controls:f,handles:v,radius:void 0,parent:t.parentNode},p.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_destroy",value:function(){var t=this.storage.controls;I(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart);var e=t.parentNode;e.parentNode.removeChild(e)}},{key:"_compute",value:function(t){var e=this.storage.handles,r=I(t.target),n=this._checkHandles(r,e),o=n.revX,a=n.revY,s=n.doW,i=n.doH,c=p(n,["revX","revY","doW","doH"]),l=r.is(e.tr)||r.is(e.bl)?-1:1,u=this._getState({factor:l,revX:o,revY:a,doW:s,doH:i}),h=this._cursorPoint(t),f=h.x,v=h.y;return P({},u,{},c,{handle:r,pressang:Math.atan2(v-u.center.y,f-u.center.x)})}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,n=W(this.storage.transform.matrix);return n[4]=n[5]=0,this._applyMatrixToPoint(R(n),e,r)}},{key:"_pointToControls",value:function(t){return this._pointToElement(t)}},{key:"_applyMatrixToPoint",value:function(t,e,r){return z({x:e,y:r},t)}},{key:"_cursorPoint",value:function(t){return z({x:t.clientX,y:t.clientY},R(C(O(I(this.options.container)))))}},{key:"_apply",value:function(){var t=this.el,e=this.storage,r=I(t),n=e.cached,o=e.controls,a=e.transform,s=e.handles,i=I(o),c=parseFloat(i.css("width"))/2,l=parseFloat(i.css("height"))/2,u=s.center,h=rt(u),f=h?parseFloat(I(u).css("left")):c,v=h?parseFloat(I(u).css("top")):l;if(t.setAttribute("data-cx",f),t.setAttribute("data-cy",v),!q(n)){var p=n.dx,y=n.dy,d=k(a.matrix),b=parseFloat(t.style.left||r.css("left")),x=parseFloat(t.style.top||r.css("top"));d.left="".concat(b+p,"px"),d.top="".concat(x+y,"px"),r.css(d),i.css(d),this.storage.cached=null}}},{key:"_processResize",value:function(t,e){var r=this.el,n=this.storage,o=this.options.proportions,a=n.controls,s=n.coords,i=n.cw,c=n.ch,l=n.transform,u=n.refang,h=n.revX,f=n.revY,v=n.doW,p=n.doH,y=v||!v&&!p?(i+t)/i:(c+e)/c,d=o?i*y:i+t,b=o?c*y:c+e;if(!(d<M||b<M)){var x=W(l.matrix),m=Y(x[4],x[5],d,b,u,h,f,v,p),g=s.left-m.left,_=s.top-m.top;x[4]+=g,x[5]+=_;var w=k(x);w.width="".concat(d,"px"),w.height="".concat(b,"px"),I(a).css(w),I(r).css(w),n.cached={dx:g,dy:_}}}},{key:"_processMove",value:function(t,e){var r=this.el,n=this.storage,o=n.controls,a=n.transform,s=a.matrix,i=W(a.parentMatrix);i[4]=i[5]=0;var c=W(s);c[4]=s[4]+t,c[5]=s[5]+e;var l=k(c);I(o).css(l),I(r).css(l),n.cached={dx:t,dy:e}}},{key:"_processRotate",value:function(t){var e=this.el,r=this.storage,n=r.controls,o=r.transform,a=r.center,s=o.matrix,i=o.parentMatrix,c=ce(Math.cos(t)),l=ce(Math.sin(t)),u=[1,0,0,1,a.cx,a.cy],h=[c,l,-l,c,0,0],f=W(i);f[4]=f[5]=0;var v=k(X(X(X(u,X(R(f),X(h,f))),R(u)),s));I(n).css(v),I(e).css(v)}},{key:"_getState",value:function(t){var e=t.factor,r=t.revX,n=t.revY,o=t.doW,a=t.doH,s=this.el,i=this.storage,c=this.options.container,l=i.handles,u=i.controls,h=i.parent,f=l.center,v=I(u),p=C(O(I(c))),y=C(O(I(u))),d=C(O(I(h))),b=Math.atan2(y[1],y[0])*e,x=h!==c?X(d,p):p,m={matrix:y,parentMatrix:x,scX:Math.sqrt(y[0]*y[0]+y[1]*y[1]),scY:Math.sqrt(y[2]*y[2]+y[3]*y[3])},g=parseFloat(v.css("width")),_=parseFloat(v.css("height")),w=Y(y[4],y[5],g,_,b,r,n,o,a),k=g/2,M=_/2,j=D(s),T=rt(f),V=T?parseFloat(I(f).css("left")):k,E=T?parseFloat(I(f).css("top")):M,A=T?B:0,S=z({x:j.left,y:j.top},R(x));return{transform:m,cw:g,ch:_,coords:w,center:{x:S.x+V-A,y:S.y+E-A,cx:-V+k-A,cy:-E+M-A,hx:V,hy:E},factor:e,refang:b,revX:r,revY:n,doW:o,doH:a}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles,o=r.center,a="".concat(o.hx+t,"px"),s="".concat(o.hy+e,"px");I(n.center).css({left:a,top:s})}},{key:"resetCenterPoint",value:function(){I(this.storage.handles.center).css({left:null,top:null})}},{key:"controls",get:function(){return this.storage.controls}}]),n}();var T=A("svg").createSVGPoint(),V=["circle","ellipse","image","line","path","polygon","polyline","rect","text","g"];function A(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function nt(){return A("svg").createSVGMatrix()}function ot(t,e){return(e.getScreenCTM()||nt()).inverse().multiply(t.getScreenCTM()||nt())}function S(t){var e=t.a,r=t.b,n=t.c,o=t.d,a=t.e,s=t.f;return"matrix(".concat(e,",").concat(r,",").concat(n,",").concat(o,",").concat(a,",").concat(s,")")}function le(t,e,r){return T.x=e,T.y=r,T.matrixTransform(t)}function ue(t){var e=nt();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}var E=/\s*([achlmqstvz])([^achlmqstvz]*)\s*/gi,L=/\s*,\s*|\s+/g;function he(t){for(var e=E.lastIndex=0,r=[];e=E.exec(t);){var n=e[1],o=n.toUpperCase(),a=e[2].replace(/([^e])-/g,"$1 -").replace(/ +/g," ");r.push({relative:n!==o,key:o,cmd:n,values:a.trim().split(L).map(function(t){if(!isNaN(t))return Number(t)})})}return r}var Z=5,$=50,J=/[+-]?\d+(\.\d+)?/g,K=function(){function n(t,e,r){return s(this,n),i(this,a(n).call(this,t,e,r))}return t(n,w),r(n,[{key:"_init",value:function(t){var e=this.options,r=e.rotationPoint,n=e.container,a=e.themeColor,o=A("g");G(o,"sjx-svg-wrapper"),n.appendChild(o);var s=t.getBBox(),i=s.width,c=s.height,l=s.x,u=s.y,h=ot(t,n),f=A("rect");[["width",i],["height",c],["x",l],["y",u],["fill",a],["fill-opacity",.1],["stroke",a],["stroke-dasharray","3 3"],["vector-effect","non-scaling-stroke"],["transform",S(h)]].forEach(function(t){var e=se(t,2),r=e[0],n=e[1];f.setAttribute(r,n)});var v=A("g"),p=A("g"),y=A("g");G(y,"sjx-svg-box-group"),G(v,"sjx-svg-handles"),G(p,"sjx-svg-normal-group"),y.appendChild(f),o.appendChild(y),o.appendChild(p),o.appendChild(v);var d=f.getBBox(),b=d.x,x=d.y,m=d.width,g=d.height,_=t.getAttribute("data-cx"),w=t.getAttribute("data-cy"),k=ot(f,f.parentNode),M=le(k,b+m/2,x+g/2),j={tl:le(k,b,x),tr:le(k,b+m,x),br:le(k,b+m,x+g),bl:le(k,b,x+g),tc:le(k,b+m/2,x),bc:le(k,b+m/2,x+g),ml:le(k,b,x+g/2),mr:le(k,b+m,x+g/2),center:r?function(t,e,r){if(q(e)||q(r))return null;var n=t.createSVGPoint();return n.x=e,n.y=r,n}(n,_,w)||M:void 0,rotator:{}},T=Math.atan2(j.tl.y-j.tr.y,j.tl.x-j.tr.x);j.rotator.x=j.mr.x-$*Math.cos(T),j.rotator.y=j.mr.y-$*Math.sin(T);var V=A("line");V.x1.baseVal.value=j.mr.x,V.y1.baseVal.value=j.mr.y,V.x2.baseVal.value=j.rotator.x,V.y2.baseVal.value=j.rotator.y,lt(V,a),p.appendChild(V);var E=null;r&&(G(E=A("line"),"sjx-hidden"),E.x1.baseVal.value=M.x,E.y1.baseVal.value=M.y,E.x2.baseVal.value=_||M.x,E.y2.baseVal.value=w||M.y,lt(E,"#fe3232"),E.setAttribute("opacity",.5),p.appendChild(E)),Object.keys(j).forEach(function(t){var e=j[t];if(!q(e)){var r=e.x,n=e.y,o="center"===t?"#fe3232":a;j[t]=function(t,e,r,n){var o=A("circle");G(o,"sjx-svg-hdl-".concat(n));var a={cx:t,cy:e,r:5.5,fill:r,stroke:"#fff","fill-opacity":1,"vector-effect":"non-scaling-stroke","stroke-width":1};return Object.keys(a).map(function(t){o.setAttribute(t,a[t])}),o}(r,n,o,t),v.appendChild(j[t])}}),this.storage={wrapper:o,box:f,handles:j,normalLine:V,radius:r?E:void 0,parent:t.parentNode},I(o).on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_destroy",value:function(){var t=this.storage.wrapper;I(t).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),t.parentNode.removeChild(t)}},{key:"_compute",value:function(t){var e=this.storage.handles,r=I(t.target),n=this._checkHandles(r,e),o=n.revX,a=n.revY,s=n.doW,i=n.doH,c=p(n,["revX","revY","doW","doH"]),l=this._getState({revX:o,revY:a,doW:s,doH:i}),u=this._cursorPoint(t),h=u.x,f=u.y;return P({},l,{},c,{handle:r,pressang:Math.atan2(f-l.center.y,h-l.center.x)})}},{key:"_cursorPoint",value:function(t){var e=t.clientX,r=t.clientY;return le(this.options.container.getScreenCTM().inverse(),e,r)}},{key:"_pointToElement",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.ctm.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_pointToControls",value:function(t){var e=t.x,r=t.y,n=this.storage.transform.boxCTM.inverse();return n.e=n.f=0,this._applyMatrixToPoint(n,e,r)}},{key:"_applyMatrixToPoint",value:function(t,e,r){var n=this.options.container.createSVGPoint();return n.x=e,n.y=r,n.matrixTransform(t)}},{key:"_apply",value:function(t){var s=this.el,e=this.storage,i=this.options.container,r=e.box,n=e.handles,o=e.cached,a=e.transform,c=a.matrix,l=s.getBBox(),u=l.x,h=l.y,f=l.width,v=l.height,p=rt(n.center)?le(a.boxCTM,n.center.cx.baseVal.value,n.center.cy.baseVal.value):le(c,u+f/2,h+v/2);if(s.setAttribute("data-cx",p.x),s.setAttribute("data-cy",p.y),!q(o)){var y=o.scaleX,d=o.scaleY,b=o.dx,x=o.dy,m=o.ox,g=o.oy;if("drag"===t){if(0===b&&0===x)return;var _=nt();_.e=b,_.f=x;var w=_.multiply(c).multiply(_.inverse());if(s.setAttribute("transform",S(w)),st(s))it(s).forEach(function(t){var e=i.createSVGPoint(),r=ot(s.parentNode,i).inverse();e.x=m,e.y=g,r.e=r.f=0;var n=e.matrixTransform(r),o=nt();o.e=b,o.f=x;var a=o.multiply(ot(t,t.parentNode)).multiply(o.inverse());!function(t){var e=t.a,r=t.b,n=t.c,o=t.d,a=t.e,s=t.f;return 1===e&&0===r&&0===n&&1===o&&0===a&&0===s}(a)&&t.setAttribute("transform",S(a)),st(t)||tt(t,{x:n.x,y:n.y})});else tt(s,{x:b,y:x})}if("resize"===t){var k=r.getBBox(),M=k.x,j=k.y,T=k.width,V=k.height;if(at(e,{x:M,y:j,width:T,height:V}),st(s))it(s).forEach(function(t){st(t)||et(t,{scaleX:y,scaleY:d,defaultCTM:t.__ctm__,bBox:a.bBox,container:i,storage:e})});else et(s,{scaleX:y,scaleY:d,defaultCTM:a.ctm,bBox:a.bBox,container:i,storage:e});s.setAttribute("transform",S(c))}this.storage.cached=null}}},{key:"_processResize",value:function(t,e){var r=this.el,n=this.storage,o=this.options.proportions,a=this.storage,s=a.box,i=a.left,c=a.top,l=a.cw,u=a.ch,h=a.transform,f=a.revX,v=a.revY,p=a.doW,y=a.doH,d=h.matrix,b=h.scMatrix,x=h.trMatrix,m=h.scaleX,g=h.scaleY,_=s.getBBox(),w=_.width,k=_.height,M=p||!p&&!y?(l+t)/l:(u+e)/u;if(w=o?l*M:l+t,k=o?u*M:u+e,!(Math.abs(w)<Z||Math.abs(k)<Z)){var j=w/l,T=k/u;b.a=j,b.b=0,b.c=0,b.d=T,b.e=0,b.f=0,x.e=m,x.f=g;var V=x.multiply(b).multiply(x.inverse()),E=d.multiply(V);r.setAttribute("transform",S(E)),this.storage.cached={scaleX:j,scaleY:T},at(n,{x:i-(w-l)*(y?.5:f?1:0),y:c-(k-u)*(p?.5:v?1:0),width:w,height:k})}}},{key:"_processMove",value:function(t,e){var r=this.storage,n=r.transform,o=r.wrapper,a=r.center,s=n.matrix,i=n.trMatrix,c=n.scMatrix,l=n.wrapperMatrix,u=n.parentMatrix;c.e=t,c.f=e;var h=c.multiply(l);o.setAttribute("transform",S(h)),u.e=u.f=0;var f=le(u.inverse(),t,e),v=f.x,p=f.y;i.e=v,i.f=p;var y=i.multiply(s);if(this.el.setAttribute("transform",S(y)),this.storage.cached={dx:v,dy:p,ox:t,oy:e},a.isShifted){var d=l.inverse();d.e=d.f=0;var b=le(d,t,e),x=b.x,m=b.y;this._moveCenterHandle(-x,-m)}}},{key:"_processRotate",value:function(t){var e=this.storage,r=e.center,n=e.transform,o=e.wrapper,a=n.matrix,s=n.wrapperMatrix,i=n.parentMatrix,c=n.trMatrix,l=n.scMatrix,u=n.rotMatrix,h=ce(Math.cos(t)),f=ce(Math.sin(t));c.e=r.x,c.f=r.y,u.a=h,u.b=f,u.c=-f,u.d=h;var v=c.multiply(u).multiply(c.inverse()).multiply(s);o.setAttribute("transform",S(v)),l.e=r.el_x,l.f=r.el_y,i.e=i.f=0;var p=i.inverse().multiply(u).multiply(i),y=l.multiply(p).multiply(l.inverse()).multiply(a);this.el.setAttribute("transform",S(y))}},{key:"_getState",value:function(t){var e=t.revX,r=t.revY,n=t.doW,o=t.doH,a=this.el,s=this.storage,i=this.options.container,c=s.box,l=s.wrapper,u=s.parent,h=s.handles.center,f=a.getBBox(),v=f.x,p=f.y,y=f.width,d=f.height,b=c.getBBox(),x=b.width,m=b.height,g=b.x,_=b.y,w=ot(a,u),k=ot(a,i),M=ot(c.parentNode,i),j=ot(u,i),T=v+y*(o?.5:e?1:0),V=p+d*(n?.5:r?1:0),E={matrix:w,ctm:k,boxCTM:M,parentMatrix:j,wrapperMatrix:ot(l,l.parentNode),trMatrix:nt(),scMatrix:nt(),rotMatrix:nt(),scaleX:T,scaleY:V,scX:Math.sqrt(k.a*k.a+k.b*k.b),scY:Math.sqrt(k.c*k.c+k.d*k.d),bBox:f},A=g+x/2,S=_+m/2,O=le(M,h?h.cx.baseVal.value:A,h?h.cy.baseVal.value:S),C=O.x,P=O.y,D=rt(h)?le(j.inverse(),C,P):le(w,v+y/2,p+d/2),N=D.x,z=D.y,R=le(ot(c,i),A,S),X=R.x,Y=R.y;return it(a).forEach(function(t){t.__ctm__=ot(t,i)}),{transform:E,cw:x,ch:m,center:{x:h?C:X,y:h?P:Y,el_x:N,el_y:z,hx:h?h.cx.baseVal.value:null,hy:h?h.cy.baseVal.value:null,isShifted:ce(X,3)!==ce(C,3)&&ce(Y,3)!==ce(P,3)},left:g,top:_,revX:e,revY:r,doW:n,doH:o}}},{key:"_moveCenterHandle",value:function(t,e){var r=this.storage,n=r.handles,o=r.center,a=r.radius;q(n.center)||(n.center.cx.baseVal.value=o.hx+t,n.center.cy.baseVal.value=o.hy+e,a.x2.baseVal.value=o.hx+t,a.y2.baseVal.value=o.hy+e)}},{key:"resetCenterPoint",value:function(){var t=this.storage,e=t.box,r=t.handles,n=t.radius,o=r.center,a=e.getBBox(),s=a.width,i=a.height,c=a.x,l=a.y,u=le(ot(e,e.parentNode),c+s/2,l+i/2),h=u.x,f=u.y;o.cx.baseVal.value=h,o.cy.baseVal.value=f,o.isShifted=!1,n.x2.baseVal.value=h,n.y2.baseVal.value=f}},{key:"controls",get:function(){return this.storage.wrapper}}]),n}();function tt(e,t){var r=t.x,n=t.y,o=[];switch(e.tagName.toLowerCase()){case"text":var a=rt(e.x.baseVal[0])?e.x.baseVal[0].value+r:(Number(e.getAttribute("x"))||0)+r,s=rt(e.y.baseVal[0])?e.y.baseVal[0].value+n:(Number(e.getAttribute("y"))||0)+n;o.push(["x",a],["y",s]);break;case"use":case"image":case"rect":var i=rt(e.x.baseVal.value)?e.x.baseVal.value+r:(Number(e.getAttribute("x"))||0)+r,c=rt(e.y.baseVal.value)?e.y.baseVal.value+n:(Number(e.getAttribute("y"))||0)+n;o.push(["x",i],["y",c]);break;case"circle":case"ellipse":var l=e.cx.baseVal.value+r,u=e.cy.baseVal.value+n;o.push(["cx",l],["cy",u]);break;case"line":var h=e.x1.baseVal.value+r,f=e.y1.baseVal.value+n,v=e.x2.baseVal.value+r,p=e.y2.baseVal.value+n;o.push(["x1",h],["y1",f],["x2",v],["y2",p]);break;case"polygon":case"polyline":var y=ct(e.getAttribute("points")).map(function(t){return t[0]=Number(t[0])+r,t[1]=Number(t[1])+n,t.join(" ")}).join(" ");o.push(["points",y]);break;case"path":var d=e.getAttribute("d");o.push(["d",function(t){var e=t.path,r=t.dx,n=t.dy;try{for(var o=he(e),a="",s=" ",i=!0,c=0,l=o.length;c<l;c++){var u=o[c],h=u.values,f=u.key,v=u.relative,p=[];switch(f){case"M":for(var y=0,d=h.length;y<d;y+=2){var b=se(h.slice(y,y+2),2),x=b[0],m=b[1];v&&!i||(x+=r,m+=n),p.push(x,m),i=!1}break;case"A":for(var g=0,_=h.length;g<_;g+=7){var w=h.slice(g,g+7);v||(w[5]+=r,w[6]+=n),p.push.apply(p,W(w))}break;case"C":for(var k=0,M=h.length;k<M;k+=6){var j=h.slice(k,k+6);v||(j[0]+=r,j[1]+=n,j[2]+=r,j[3]+=n,j[4]+=r,j[5]+=n),p.push.apply(p,W(j))}break;case"H":for(var T=0,V=h.length;T<V;T+=1){var E=h.slice(T,T+1);v||(E[0]+=r),p.push(E[0])}break;case"V":for(var A=0,S=h.length;A<S;A+=1){var O=h.slice(A,A+1);v||(O[0]+=n),p.push(O[0])}break;case"L":case"T":for(var C=0,P=h.length;C<P;C+=2){var D=se(h.slice(C,C+2),2),N=D[0],z=D[1];v||(N+=r,z+=n),p.push(N,z)}break;case"Q":case"S":for(var R=0,X=h.length;R<X;R+=4){var Y=se(h.slice(R,R+4),4),B=Y[0],L=Y[1],F=Y[2],H=Y[3];v||(B+=r,L+=n,F+=r,H+=n),p.push(B,L,F,H)}break;case"Z":s=h[0]=""}a+=u.cmd+p.join(",")+s}return a}catch(t){ie("Path parsing error: "+t)}}({path:d,dx:r,dy:n})])}o.forEach(function(t){e.setAttribute(t[0],t[1])})}function et(o,t){var e=t.scaleX,r=t.scaleY,n=t.bBox,a=t.defaultCTM,s=t.container,i=n.width,c=n.height,l=[],u=ot(o,s),h=a.inverse().multiply(u);switch(o.tagName.toLowerCase()){case"text":var f=rt(o.x.baseVal[0])?o.x.baseVal[0].value:Number(o.getAttribute("x"))||0,v=rt(o.y.baseVal[0])?o.y.baseVal[0].value:Number(o.getAttribute("y"))||0,p=le(h,f,v),y=p.x,d=p.y;l.push(["x",y+(e<0?i:0)],["y",d+(r<0?c:0)]);break;case"circle":var b=o.r.baseVal.value,x=o.cx.baseVal.value,m=o.cy.baseVal.value,g=b*(Math.abs(e)+Math.abs(r))/2,_=le(h,x,m),w=_.x,k=_.y;l.push(["r",g],["cx",w],["cy",k]);break;case"image":case"rect":var M=o.width.baseVal.value,j=o.height.baseVal.value,T=o.x.baseVal.value,V=o.y.baseVal.value,E=le(h,T,V),A=E.x,S=E.y,O=Math.abs(M*e),C=Math.abs(j*r);l.push(["x",A-(e<0?O:0)],["y",S-(r<0?C:0)],["width",O],["height",C]);break;case"ellipse":var P=o.rx.baseVal.value,D=o.ry.baseVal.value,N=o.cx.baseVal.value,z=o.cy.baseVal.value,R=le(h,N,z),X=R.x,Y=R.y,B=nt();B.a=e,B.d=r;var L=le(B,P,D),F=L.x,H=L.y;l.push(["rx",Math.abs(F)],["ry",Math.abs(H)],["cx",X],["cy",Y]);break;case"line":var W=o.x1.baseVal.value,q=o.y1.baseVal.value,I=o.x2.baseVal.value,G=o.y2.baseVal.value,U=le(h,W,q),Q=U.x,Z=U.y,$=le(h,I,G),J=$.x,K=$.y;l.push(["x1",Q],["y1",Z],["x2",J],["y2",K]);break;case"polygon":case"polyline":var tt=ct(o.getAttribute("points")).map(function(t){var e=le(h,Number(t[0]),Number(t[1])),r=e.x,n=e.y;return t[0]=r,t[1]=n,t.join(" ")}).join(" ");l.push(["points",tt]);break;case"path":var et=o.getAttribute("d");l.push(["d",function(t){var e=t.path,r=t.localCTM;try{for(var n=he(e),o="",a=" ",s=[],i=!0,c=0,l=n.length;c<l;c++){var u=n[c],h=u.values,f=u.key,v=u.relative;switch(f){case"A":for(var p=[],y=0,d=h.length;y<d;y+=7){var b=se(h.slice(y,y+7),7),x=b[0],m=b[1],g=b[2],_=b[3],w=b[4],k=b[5],M=b[6],j=ue(r);v&&(j.e=j.f=0);var T=le(j,k,M),V=T.x,E=T.y;p.push(ce(V),ce(E)),j.e=j.f=0;var A=le(j,x,m),S=A.x,O=A.y;p.unshift(ce(S),ce(O),g,_,w)}s.push(p);break;case"C":for(var C=[],P=0,D=h.length;P<D;P+=6){var N=se(h.slice(P,P+6),6),z=N[0],R=N[1],X=N[2],Y=N[3],B=N[4],L=N[5],F=ue(r);v&&(F.e=F.f=0);var H=le(F,z,R),W=H.x,q=H.y,I=le(F,X,Y),G=I.x,U=I.y,Q=le(F,B,L),Z=Q.x,$=Q.y;C.push(ce(W),ce(q),ce(G),ce(U),ce(Z),ce($))}s.push(C);break;case"H":for(var J=[],K=0,tt=h.length;K<tt;K+=1){var et=se(h.slice(K,K+1),1)[0],rt=ue(r);v&&(rt.e=rt.f=0);var nt=le(rt,et,0).x;J.push(ce(nt))}s.push(J);break;case"V":for(var ot=[],at=0,st=h.length;at<st;at+=1){var it=se(h.slice(at,at+1),1)[0],ct=ue(r);v&&(ct.e=ct.f=0);var lt=le(ct,0,it).y;ot.push(ce(lt))}s.push(ot);break;case"T":case"L":for(var ut=[],ht=0,ft=h.length;ht<ft;ht+=2){var vt=se(h.slice(ht,ht+2),2),pt=vt[0],yt=vt[1],dt=ue(r);v&&(dt.e=dt.f=0);var bt=le(dt,pt,yt),xt=bt.x,mt=bt.y;ut.push(ce(xt),ce(mt))}s.push(ut);break;case"M":for(var gt=[],_t=0,wt=h.length;_t<wt;_t+=2){var kt=se(h.slice(_t,_t+2),2),Mt=kt[0],jt=kt[1],Tt=ue(r);v&&!i&&(Tt.e=Tt.f=0);var Vt=le(Tt,Mt,jt),Et=Vt.x,At=Vt.y;gt.push(ce(Et),ce(At)),i=!1}s.push(gt);break;case"Q":for(var St=[],Ot=0,Ct=h.length;Ot<Ct;Ot+=4){var Pt=se(h.slice(Ot,Ot+4),4),Dt=Pt[0],Nt=Pt[1],zt=Pt[2],Rt=Pt[3],Xt=ue(r);v&&(Xt.e=Xt.f=0);var Yt=le(Xt,Dt,Nt),Bt=Yt.x,Lt=Yt.y,Ft=le(Xt,zt,Rt),Ht=Ft.x,Wt=Ft.y;St.push(ce(Bt),ce(Lt),ce(Ht),ce(Wt))}s.push(St);break;case"S":for(var qt=[],It=0,Gt=h.length;It<Gt;It+=4){var Ut=se(h.slice(It,It+4),4),Qt=Ut[0],Zt=Ut[1],$t=Ut[2],Jt=Ut[3],Kt=ue(r);v&&(Kt.e=Kt.f=0);var te=le(Kt,Qt,Zt),ee=te.x,re=te.y,ne=le(Kt,$t,Jt),oe=ne.x,ae=ne.y;qt.push(ce(ee),ce(re),ce(oe),ce(ae))}s.push(qt);break;case"Z":s.push([""]),a=""}o+=u.cmd+s[c].join(",")+a}return o}catch(t){ie("Path parsing error: "+t)}}({path:et,localCTM:h})])}l.forEach(function(t){var e=se(t,2),r=e[0],n=e[1];o.setAttribute(r,n)})}function at(t,e){var r=t.box,n=t.handles,o=t.normalLine,a=t.radius,s=t.center,i=e.x,c=e.y,l=e.width,u=e.height,h=l/2,f=u/2,v=ot(r,r.parentNode),p=le(v,i+h,c+f),y={tl:le(v,i,c),tr:le(v,i+l,c),br:le(v,i+l,c+u),bl:le(v,i,c+u),tc:le(v,i+h,c),bc:le(v,i+h,c+u),ml:le(v,i,c+f),mr:le(v,i+l,c+f),rotator:{},center:!s.isShifted&&rt(n.center)?p:void 0},d=Math.atan2(y.tl.y-y.tr.y,y.tl.x-y.tr.x);y.rotator.x=y.mr.x-$*Math.cos(d),y.rotator.y=y.mr.y-$*Math.sin(d),o.x1.baseVal.value=y.mr.x,o.y1.baseVal.value=y.mr.y,o.x2.baseVal.value=y.rotator.x,o.y2.baseVal.value=y.rotator.y,rt(a)&&(a.x1.baseVal.value=p.x,a.y1.baseVal.value=p.y,s.isShifted||(a.x2.baseVal.value=p.x,a.y2.baseVal.value=p.y));var b={x:i+=l<0?l:0,y:c+=u<0?u:0,width:Math.abs(l),height:Math.abs(u)};Object.keys(b).forEach(function(t){r.setAttribute(t,b[t])}),Object.keys(y).forEach(function(t){var e=n[t],r=y[t];q(r)||(e.setAttribute("cx",r.x),e.setAttribute("cy",r.y))})}function st(t){return"g"===t.tagName.toLowerCase()}function it(t){var r=[];return st(t)?l.call(t.childNodes,function(t){if(1===t.nodeType){var e=t.tagName.toLowerCase();-1!==V.indexOf(e)&&("g"===e&&r.push.apply(r,W(it(t))),r.push(t))}}):r.push(t),r}function ct(t){return t.match(J).reduce(function(t,e,r,n){return r%2==0&&t.push(n.slice(r,r+2)),t},[])}function lt(t,e){t.setAttribute("stroke",e),t.setAttribute("stroke-dasharray","3 3"),t.setAttribute("vector-effect","non-scaling-stroke")}function ut(r,t){if(this.length){var n=rt(t)&&t instanceof m?t:new m;return v.call(this,function(t,e){return e instanceof SVGElement?function(t){var e=t.tagName.toLowerCase();return-1!==V.indexOf(e)||(ie("Selected element is not allowed to transform. Allowed elements:\n"+"circle, ellipse, image, line, path, polygon, polyline, rect, text, g"),!1)}(e)&&t.push(new K(e,r,n)):t.push(new j(e,r,n)),t},[])}}var ht=function(){function n(t,e){var r;return s(this,n),(r=i(this,a(n).call(this,t))).enable(e),r}return t(n,g),r(n,[{key:"_init",value:function(){var t=this.el,e=this.options,r=I(t),n=e.style,o=e.appendTo,a=P({position:"absolute","z-index":"2147483647"},n);this.storage={css:a,parent:rt(o)?I(o)[0]:document.body},r.on("mousedown",this._onMouseDown).on("touchstart",this._onTouchStart)}},{key:"_processOptions",value:function(t){var e={},r=null,n=document,o=function(){},a=function(){},s=function(){},i=function(){};if(rt(t)){var c=t.style,l=t.appendTo,u=t.stack,h=t.onInit,f=t.onMove,v=t.onDrop,p=t.onDestroy;e=rt(c)&&"object"===d(c)?c:e,r=l||null;var y=rt(u)?I(u)[0]:document;o=F(h),a=F(f),s=b(v)?function(t){var e=this.storage.clone;!function(t,e){var r=D(t),n=r.top,o=r.left,a=D(e),s=a.top,i=a.left,c=I(t),l=I(e);return!(n<s||n+parseFloat(c.css("height"))>s+parseFloat(l.css("height"))||o<i||o+parseFloat(c.css("width"))>i+parseFloat(l.css("width")))}(e,y)||v.call(this,t,this.el,e)}:function(){},i=F(p)}this.options={style:e,appendTo:r,stack:n},this.proxyMethods={onInit:o,onDrop:s,onMove:a,onDestroy:i}}},{key:"_start",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage,o=this.el,a=n.parent,s=n.css,i=D(a),c=i.left,l=i.top;s.left="".concat(e-c,"px"),s.top="".concat(r-l,"px");var u=o.cloneNode(!0);I(u).css(s),n.clientX=e,n.clientY=r,n.cx=e,n.cy=r,n.clone=u,I(a)[0].appendChild(u),this._draw()}},{key:"_moving",value:function(t){var e=t.clientX,r=t.clientY,n=this.storage;n.clientX=e,n.clientY=r,n.doDraw=!0,n.doMove=!0}},{key:"_end",value:function(t){var e=this.storage,r=e.clone,n=e.frameId;e.doDraw=!1,u(n),q(r)||(this.proxyMethods.onDrop.call(this,t),r.parentNode.removeChild(r),delete e.clone)}},{key:"_animate",value:function(){var t=this.storage;t.frameId=H(this._animate);var e=t.doDraw,r=t.clientX,n=t.clientY,o=t.cx,a=t.cy;e&&(t.doDraw=!1,this._drag(r-o,n-a))}},{key:"_processMove",value:function(t,e){var r=this.storage.clone,n="translate(".concat(t,"px, ").concat(e,"px)");I(r).css({transform:n,webkitTranform:n,mozTransform:n,msTransform:n,otransform:n})}},{key:"_destroy",value:function(){var t=this.storage,e=this.proxyMethods,r=this.el;q(t)||(I(r).off("mousedown",this._onMouseDown).off("touchstart",this._onTouchStart),e.onDestroy.call(this,r),delete this.storage)}},{key:"disable",value:function(){this._destroy()}}]),n}();function ft(e){if(this.length)return f.call(this,function(t){return new ht(t,e)})}var vt=function(){function e(t){return s(this,e),i(this,a(e).call(this,t))}return t(e,y),r(e,[{key:"drag",value:function(){return ut.call.apply(ut,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"clone",value:function(){return ft.call.apply(ft,[this].concat(Array.prototype.slice.call(arguments)))}}]),e}();function pt(t){return new vt(t)}return Object.defineProperty(pt,"createObservable",{value:function(){return new m}}),Object.defineProperty(pt,"Subjx",{value:vt}),Object.defineProperty(pt,"Observable",{value:m}),pt});
